apiVersion: batch/v1
kind: Job
metadata:
  name: hello-probe
  namespace: hello
spec:
  template:
    metadata:
      labels:
        app: hello-probe
    spec:
      restartPolicy: Never
      containers:
        - name: curl
          image: curlimages/curl:8.10.1
          args:
            # On teste via le DNS de service (ClusterIP), donc pas besoin d'Endpoints visibles dans l'UI
            - /bin/sh
            - -c
            - |
              set -e
              echo "DNS -> hello-minikube.hello.svc.cluster.local:80"
              for i in $(seq 1 5); do
                echo "---- try $i ----"
                curl -si http://hello-minikube.hello.svc.cluster.local:80/ | head -n 1
                sleep 2
              done
              echo "OK"
